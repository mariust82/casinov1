var Score=function(e){var i=e,a=i.name,t=i.value,s=new XMLHttpRequest;(function(e,i){BUSY_REQUEST||(BUSY_REQUEST=!0,s.abort(),s=$.ajax({url:"/casino/rate",data:{name:e,value:i},dataType:"json",type:"post",success:function(e){"Casino already rated!"==e.body.success&&($(".icon-icon_available").toggleClass("icon-icon_unavailable"),$(".icon-icon_unavailable").removeClass("icon-icon_available"),$(".thanx").html(e.body.success)),$(".rating-container").next(".action-field").show()},error:function(e){"abort"!=e.statusText&&console.log("err")},complete:function(){BUSY_REQUEST=!1}}))})(a,t)};function AddingReview(e){var a,t,s,r,d,n,o,l,v,c,f,u,m,p,i=this.obj=e,w=$("#reviews-form").data("img-dir"),g=$("#reviews-form").data("country"),b=i.find("input[name=submit]"),_=$(".reviews-qty"),h="not-valid",x=$(".reviews-form").data("casino-id"),y=localStorage.getItem("casino_"+x+"_reviewed"),R=localStorage.getItem("casino_"+x+"_score"),E=new XMLHttpRequest;_prepReview=function(e){var i=e;return t=i.find("input[name=name]"),s=i.find("input[name=email]"),r=i.find("textarea[name=body]"),d=i.find(".field-error-required"),n=i.find(".field-error-rate"),_contact_error=i.find(".field-error"),l=t.val(),v=s.val(),c=r.val(),casino_name=$(".rating-container").data("casino-name"),m=$(".rating-current-value span").text(),a=0,ok=!0,null!=i.data("id")?(a=i.data("id"),f=!0,0<i.next().find(".reply-data-holder").length?(o=i.next().find(".reply-data-holder"),u=!1):(u=!0,a=i.closest(".reply").prev().data("id"),_setReviewerName(i),o=i.closest(".reply-data-holder")),p=i.find(".js-reply-btn span")):(f=!1,o=$("#review-data-holder")),""===l?(t.parent().addClass(h),ok=!1):t.parent().removeClass(h),""!==v&&validateEmail(v)?s.parent().removeClass(h):(s.parent().addClass(h),ok=!1),""===c?(r.parent().addClass(h),ok=!1):r.parent().removeClass(h),ok?(_contact_error.hide(),d.hide()):d.show(),f||("0"===m?(n.show(),i.find($(".rating-container")).addClass(h),ok=!1):(n.hide(),i.find($(".rating-container")).removeClass(h))),ok},_setReviewerName=function(e){var i=e.find(".review-name").text();c="<strong>@"+i+"</strong> "+r.val().substr(i.length+1)},_changeName=function(){$("#reviews-form input[name=name]").on("keyup",function(){$("#reviews-form .review-name").text($(this).val())})},_prepAjaxData=function(e){var i={casino:casino_name,name:l,email:v,body:c,parent:a,casino_id:$(".reviews-form").attr("data-casino-id")};_sendReview(i,e)},_sendReview=function(e,i){BUSY_REQUEST||(BUSY_REQUEST=!0,E.abort(),E=$.ajax({url:"/casino/review-write",data:e,dataType:"json",timeout:2e4,type:"POST",success:function(e){_loadData(e,i),t.val(""),s.val(""),r.val("").addClass("expanding"),_onEvents(),$(".form .js-expanding-textfields").slideUp()},error:function(e){_errors_found=$.parseJSON(e.responseText),console.error("Could not send message!"),console.log(_errors_found.body.message)},complete:function(){BUSY_REQUEST=!1}}))},_loadData=function(e,i){if($.isEmptyObject(e))_showEmptyMessage();else{function a(){return f?'                        <div class="review review-child '+l.toLowerCase()+'" data-id="'+e.body.id+'" data-img-dir="'+w+'">                            <div class="review-wrap">                                <div class="review-info">                                    <div class="review-info-top">                                        <div class="review-flag">                                            <img src="'+w+'" alt="'+g+'" width="15" height="12">                                        </div>                                        <div class="review-info-body">                                            <div class="review-name">'+l+'</div>                                            <div class="review-date">'+_getCurrDate()+'</div>                                        </div>                                    </div>                                </div>                                <div class="review-body">                                    <div class="review-text">                                        <p>'+c+'</p>                                    </div>                                    <div class="review-underline">                                        <a href="#" class="review-replies js-reply-btn">Reply</a>                                        <div class="votes js-vote">                                            <a href="#" class="votes-like vote-button" data-id="'+e.body.id+'">                                                <i class="icon-icon_likes"></i>                                                <span class="bubble bubble-vote">0</span>                                            </a>                                        </div>                                    </div>                                    <div class="review-form">                                        <div class="form">                                            <div class="form-row">                                                <div class="textfield-holder">                                                    <textarea rows="5" class="expanding textfield" name="body" placeholder="Write your review..."></textarea>                                                </div>                                            </div>                                            <div class="hidden js-expanding-textfields">                                                <div class="form-row form-multicol">                                                    <div class="form-col">                                                        <div class="textfield-holder error">                                                            <input type="text" name="name" class="textfield" placeholder="Name">                                                        </div>                                                    </div>                                                    <div class="form-col">                                                        <div class="textfield-holder error">                                                            <input type="text" name="email" class="textfield" placeholder="Email (it won\'t be published)">                                                        </div>                                                    </div>                                                </div>                                                <div class="form-row">                                                    <div class="review-submit-holder">                                                        <input class="btn" name="submit" type="submit" value="ADD YOUR REPLY">                                                        <div>                                                            <div class="field-error-required not-valid action-field">                                                                Please fill in the required fields.                                                            </div>                                                            <div class="field-success success action-field">                                                                Thank You!                                                            </div>                                                        </div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                            </div>                        </div>                        ':'                        <div class="review review-parent '+l.toLowerCase()+'" data-id="'+e.body.id+'">                            <div class="review-wrap">                                <div class="review-info">                                    <div class="review-info-top">                                        <div class="review-flag">                                            <img src="'+w+'" alt="'+g+'" width="15" height="12">                                        </div>                                        <div class="review-info-body">                                            <div class="review-name">'+l+'</div>                                            <div class="review-date">'+_getCurrDate()+'</div>                                        </div>                                    </div>                                    <div class="list-rating '+getWebName(get_rating(m))+'">                                        <div class="list-rating-wrap">                                            <div class="list-rating-score">'+m+'</div>                                            <div class="list-rating-text">'+get_rating(m)+'</div>                                        </div>                                    </div>                                </div>                                <div class="review-body">                                    <div class="review-text">                                        <p>'+c+'</p>                                    </div>                                    <div class="review-underline">                                        <a href="#" class="review-replies js-reply-btn">Reply</a>                                        <div class="votes js-vote">                                            <a href="#" class="votes-like vote-button"  data-id="'+e.body.id+'">                                                <i class="icon-icon_likes"></i>                                                <span class="bubble bubble-vote">0</span>                                            </a>                                        </div>                                    </div>                                    <div class="review-form">                                        <div class="form">                                            <div class="form-row">                                                <div class="textfield-holder">                                                    <textarea rows="5" class="expanding textfield" name="body" placeholder="Write your review..."></textarea>                                                </div>                                            </div>                                            <div class="hidden js-expanding-textfields">                                                <div class="form-row form-multicol">                                                    <div class="form-col">                                                        <div class="textfield-holder error">                                                            <input type="text" name="name" class="textfield" placeholder="Name">                                                        </div>                                                    </div>                                                    <div class="form-col">                                                        <div class="textfield-holder error">                                                            <input type="text" name="email" class="textfield" placeholder="Email (it won\'t be published)">                                                        </div>                                                    </div>                                                </div>                                                <div class="form-row">                                                    <div class="review-submit-holder">                                                        <input class="btn" name="submit" type="submit" value="ADD YOUR REPLY">                                                        <div>                                                            <div class="field-error-required not-valid action-field">                                                                Please fill in the required fields.                                                            </div>                                                            <div class="field-success success action-field">                                                                Thank You!                                                            </div>                                                        </div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    </div>                                </div>                            </div>                        </div>                        <div class="reply review">                            <div class="reply-data-holder"></div>                        </div>                        '}u?$(a()).insertAfter(i):o.prepend(a()),_refreshData()}},_refreshData=function(){f||(_.text(parseInt(_.text())+1),localStorage.setItem("casino_"+x+"_reviewed",1),localStorage.setItem("casino_"+x+"_score",m)),f&&p.text(parseInt(p.text())+1),$(".review-form").slideUp(),initReviewForm(),initTexfieldsLabels(),new Vote($(".js-vote")),$(".review, .reply").each(function(){new AddingReview($(this))}),grayscaleIE()},_doIfReviewedAlready=function(){var e=$("#reviews-form");$(".review-rating",e).addClass("active"),$("textarea",e).addClass("disabled"),$(".rating-bar").barrating("set",R),$(".rating-current-value span").text(R),$("textarea[name=body]",e).attr("placeholder","You have already reviewed")},_initForms=function(){b.off(),b.on({click:function(e){!1===_prepReview(i)?e.stopPropagation():_prepAjaxData(i)}})},_onEvents=function(){y?(_doIfReviewedAlready(),_initForms()):(_initForms(),_changeName())},_init=function(){_onEvents()},_init()}function _getCurrDate(){var e=new Date;return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()}function get_rating(e){return $string=8<e?"Excellent":6<e&&e<=8?"Very good":4<e&&e<=6?"Good":2<e&&e<=4?"Poor":"Terrible",$string}